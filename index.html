<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TF Reward & Redeem Dashboard</title>
    
    <!-- PWA Meta -->
    <meta name="theme-color" content="#0F172A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/0B5D3B/ffffff?text=TF">

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#0B5D3B',
                        secondary: '#4CAF50',
                        warning: '#F59E0B',
                        dark: '#0F172A',
                        glass: 'rgba(255, 255, 255, 0.08)',
                        glassBorder: 'rgba(255, 255, 255, 0.15)',
                    },
                    animation: {
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0F172A;
            color: #E5E7EB;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }
        .glass-card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        input, select {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            outline: none;
            transition: all 0.2s;
        }
        input:focus { border-color: #4CAF50; background: rgba(0, 0, 0, 0.4); }
        
        .tab-active { color: #4CAF50; }
        .tab-active::after {
            content: '';
            position: absolute;
            top: -4px;
            width: 4px;
            height: 4px;
            background: #4CAF50;
            border-radius: 50%;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- HEADER -->
    <header class="px-6 py-5 flex justify-between items-center glass-card rounded-b-[2.5rem] z-30 shrink-0 shadow-2xl">
        <div>
            <h1 class="text-[10px] font-bold text-secondary uppercase tracking-[0.2em]">Traders Family</h1>
            <p id="display-period" class="text-lg font-bold text-white">Financial Dashboard</p>
        </div>
        <button id="btn-open-input" class="w-12 h-12 rounded-2xl bg-secondary/10 border border-secondary/20 flex items-center justify-center text-secondary active:scale-90 transition-transform">
            <i data-lucide="plus-circle"></i>
        </button>
    </header>

    <!-- MAIN VIEWPORT -->
    <main id="main-viewport" class="flex-1 overflow-y-auto no-scrollbar p-6 pb-32">
        <!-- Zero State -->
        <div id="zero-state" class="h-full flex flex-col items-center justify-center text-center opacity-40">
            <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mb-6">
                <i data-lucide="bar-chart-3" class="w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold">Data Tidak Tersedia</h2>
            <p class="text-sm max-w-[240px] mt-2 leading-relaxed italic">Silakan masukkan data trading bulan ini untuk melihat analisis reward dan redeem.</p>
        </div>

        <!-- Rendered Sections (Hidden initially) -->
        <div id="content-container" class="hidden space-y-6"></div>
    </main>

    <!-- INPUT MODAL -->
    <div id="input-modal" class="fixed inset-0 z-50 bg-dark/95 backdrop-blur-xl hidden flex-col transition-all">
        <div class="p-6 flex justify-between items-center border-b border-white/5">
            <h2 class="text-xl font-bold">Input Performa & Status</h2>
            <button id="btn-close-input" class="text-gray-400 p-2"><i data-lucide="x"></i></button>
        </div>
        
        <form id="form-data" class="flex-1 overflow-y-auto p-6 space-y-6">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[10px] uppercase text-gray-500 font-bold">Periode</label>
                        <input type="month" id="in-period" required class="w-full p-4 rounded-2xl text-sm">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] uppercase text-gray-500 font-bold">Medali (0-14)</label>
                        <input type="number" id="in-medal" min="0" max="14" required class="w-full p-4 rounded-2xl text-sm">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] uppercase text-gray-500 font-bold">Partnership Channel</label>
                    <select id="in-partnership" class="w-full p-4 rounded-2xl text-sm appearance-none">
                        <option value="Basic">Basic</option>
                        <option value="Prospect">Prospect</option>
                        <option value="Priority">Priority</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[10px] uppercase text-gray-500 font-bold">Total Sinyal</label>
                        <input type="number" id="in-signals" required class="w-full p-4 rounded-2xl text-sm">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] uppercase text-gray-500 font-bold">Total Pips</label>
                        <input type="number" id="in-pips" step="0.1" required class="w-full p-4 rounded-2xl text-sm">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] uppercase text-gray-500 font-bold">Valued Pips Bulan Lalu</label>
                    <input type="number" id="in-prev-vp" step="0.1" required class="w-full p-4 rounded-2xl text-sm">
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] uppercase text-gray-500 font-bold">TF Point Ter-Redeem (Bulan Ini)</label>
                    <input type="number" id="in-redeemed" required class="w-full p-4 rounded-2xl text-sm">
                </div>
            </div>
            
            <div class="pt-4">
                <button type="submit" class="w-full bg-secondary py-5 rounded-[2rem] font-bold text-white shadow-xl shadow-green-900/20 active:scale-95 transition-all">
                    Update Analytics
                </button>
            </div>
        </form>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <nav class="fixed bottom-0 w-full glass-card rounded-t-[2.5rem] z-40 pb-safe">
        <div class="flex justify-around items-center h-20 px-2" id="nav-container">
            <!-- Nav Items generated by JS -->
        </div>
    </nav>

    <script>
        /** * ==========================================
         * 1. CORE LOGIC & FINANCIAL FORMULAS
         * ==========================================
         */
        const CONFIG = {
            vpMultiplier: 0.5,
            qualify: { signals: 5, vp: 300, consistency: 0.7 },
            levels: [
                { range: [0,0], label: "Newbie" },
                { range: [1,2], label: "Rookie" },
                { range: [3,4], label: "Pro" },
                { range: [5,7], label: "Elite" },
                { range: [8,12], label: "Master" },
                { range: [13,14], label: "Legend" }
            ],
            multipliers: [
                { range: [1,2], val: 0.3 },
                { range: [3,4], val: 0.4 },
                { range: [5,7], val: 0.5 },
                { range: [8,10], val: 0.7 },
                { range: [11,12], val: 1.0 },
                { range: [13,14], val: 1.5 }
            ],
            cashRates: { "Elite": 5000, "Master": 10000, "Legend": 20000 },
            partnershipLimits: {
                "Elite": { "Basic": 20, "Prospect": 30, "Priority": 0 },
                "Master": { "Basic": 30, "Prospect": 50, "Priority": 100 },
                "Legend": { "Basic": 50, "Prospect": 75, "Priority": 100 }
            }
        };

        let state = {
            inputs: null,
            results: null,
            activeTab: 'Overview'
        };

        function calculateBusinessLogic(data) {
            // Formula: Valued Pips = Total Pips * Multiplier (XAUUSD)
            const vp = data.pips * CONFIG.vpMultiplier;
            
            // Channel Level Logic
            const levelObj = CONFIG.levels.find(l => data.medal >= l.range[0] && data.medal <= l.range[1]);
            const level = levelObj ? levelObj.label : "Newbie";

            // Multiplier Logic
            const multObj = CONFIG.multipliers.find(m => data.medal >= m.range[0] && data.medal <= m.range[1]);
            const multiplier = multObj ? multObj.val : 0;

            // Qualification Rules
            const qSignals = data.signals >= CONFIG.qualify.signals;
            const qVp = vp >= CONFIG.qualify.vp;
            const qConsistency = data.medal >= 1 ? (vp >= data.prevVp * CONFIG.qualify.consistency) : true;
            const isQualified = qSignals && qVp && qConsistency;

            // TF Point Formula: TF_Point = Valued_Pips * Medal_Multiplier
            const generatedTfPoints = isQualified ? Math.floor(vp * multiplier) : 0;

            // Redeem Logic
            const limitTable = CONFIG.partnershipLimits[level] || {};
            const limitPct = limitTable[data.partnership] || 0;
            
            // Formula: max_redeemable = TF_Point * Limit_Percentage
            const maxRedeemablePoints = Math.floor(generatedTfPoints * (limitPct / 100));
            const remainingRedeemable = Math.max(0, maxRedeemablePoints - data.alreadyRedeemed);
            const progressPct = maxRedeemablePoints > 0 ? (data.alreadyRedeemed / maxRedeemablePoints) * 100 : 0;

            // Simulation scenarios
            const cashRate = CONFIG.cashRates[level] || 0;
            const immediateValue = remainingRedeemable * cashRate;
            const potentialValueFull = generatedTfPoints * cashRate;
            const deferredValue = potentialValueFull - (data.alreadyRedeemed * cashRate) - immediateValue;

            return {
                level, vp, isQualified, generatedTfPoints, multiplier,
                limitPct, maxRedeemablePoints, remainingRedeemable, progressPct,
                cashRate, immediateValue, potentialValueFull, deferredValue,
                checks: { signals: qSignals, vp: qVp, consistency: qConsistency }
            };
        }

        /** * ==========================================
         * 2. UI RENDERING & TAB MANAGEMENT
         * ==========================================
         */
        const TABS = [
            { id: 'Overview', icon: 'layout' },
            { id: 'Performance', icon: 'activity' },
            { id: 'Reward', icon: 'gift' },
            { id: 'Partnership', icon: 'users' },
            { id: 'Redeem', icon: 'wallet' },
            { id: 'Simulation', icon: 'zap' },
            { id: 'History', icon: 'history' }
        ];

        function renderNav() {
            const container = document.getElementById('nav-container');
            container.innerHTML = TABS.map(tab => `
                <button onclick="switchTab('${tab.id}')" class="relative flex flex-col items-center justify-center transition-all duration-300 ${state.activeTab === tab.id ? 'tab-active scale-110' : 'text-gray-500 opacity-60'}">
                    <i data-lucide="${tab.icon}" class="w-5 h-5 mb-1"></i>
                    <span class="text-[8px] font-bold uppercase tracking-tighter">${tab.id}</span>
                </button>
            `).join('');
            lucide.createIcons();
        }

        function switchTab(tabId) {
            state.activeTab = tabId;
            renderNav();
            renderDashboard();
        }

        function formatN(num) { return new Intl.NumberFormat('id-ID').format(num); }
        function formatC(num) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num); }

        function renderDashboard() {
            const container = document.getElementById('content-container');
            const zeroState = document.getElementById('zero-state');
            
            if (!state.results) {
                container.classList.add('hidden');
                zeroState.classList.remove('hidden');
                return;
            }

            container.classList.remove('hidden');
            zeroState.classList.add('hidden');
            container.innerHTML = '';

            const r = state.results;
            const i = state.inputs;

            // Section: Overview
            if (state.activeTab === 'Overview') {
                container.innerHTML = `
                    <div class="glass-card p-6 rounded-[2.5rem] animate-slide-up">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <p class="text-[10px] uppercase text-gray-500 font-bold mb-1">Level Anda</p>
                                <h2 class="text-3xl font-black text-white">${r.level}</h2>
                            </div>
                            <div class="px-4 py-2 bg-secondary/10 border border-secondary/20 rounded-2xl">
                                <span class="text-xs font-bold text-secondary">Medal ${i.medal}</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-black/20 rounded-2xl border border-white/5">
                                <p class="text-[9px] uppercase text-gray-500 font-bold mb-1">Status Kualifikasi</p>
                                <p class="text-sm font-bold ${r.isQualified ? 'text-secondary' : 'text-red-400'}">${r.isQualified ? 'QUALIFIED' : 'FAILED'}</p>
                            </div>
                            <div class="p-4 bg-black/20 rounded-2xl border border-white/5">
                                <p class="text-[9px] uppercase text-gray-500 font-bold mb-1">Partnership</p>
                                <p class="text-sm font-bold text-white">${i.partnership}</p>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card p-6 rounded-[2.5rem] animate-slide-up" style="animation-delay: 0.1s">
                        <p class="text-[10px] uppercase text-gray-500 font-bold mb-4">Performa Bulan Ini</p>
                        <div class="flex justify-between items-center bg-black/40 p-5 rounded-3xl">
                            <div>
                                <p class="text-xs text-gray-400">Total TF Point</p>
                                <p class="text-2xl font-black text-white">${formatN(r.generatedTfPoints)}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-400">Valued Pips</p>
                                <p class="text-xl font-bold text-secondary">${formatN(r.vp)}</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Section: Performance
            if (state.activeTab === 'Performance') {
                container.innerHTML = `
                    <div class="glass-card p-6 rounded-[2.5rem] animate-slide-up">
                        <h3 class="font-bold mb-6">Detail Performa Trading</h3>
                        <div class="space-y-4">
                            ${row('Signals Closed', i.signals, CONFIG.qualify.signals, r.checks.signals)}
                            ${row('Total Pips (Raw)', formatN(i.pips), '-', true)}
                            ${row('Valued Pips', formatN(r.vp), CONFIG.qualify.vp, r.checks.vp)}
                            ${row('Consistency Check', '70%', 'Passed', r.checks.consistency)}
                        </div>
                    </div>
                `;
            }

            // Section: Reward
            if (state.activeTab === 'Reward') {
                container.innerHTML = `
                    <div class="glass-card p-6 rounded-[2.5rem] animate-slide-up">
                        <h3 class="font-bold mb-6">Perhitungan TF Point</h3>
                        <div class="bg-black/20 p-6 rounded-3xl border border-white/5 space-y-6">
                            <div class="flex justify-between items-center font-mono text-sm">
                                <span class="text-gray-400 italic">Formula</span>
                                <span class="text-gray-500 italic">VP * Multiplier</span>
                            </div>
                            <div class="flex justify-between items-end">
                                <div>
                                    <p class="text-xs text-gray-400">Medal Multiplier</p>
                                    <p class="text-xl font-bold">x ${r.multiplier}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-xs text-gray-400">Total Reward</p>
                                    <p class="text-3xl font-black text-secondary">${formatN(r.generatedTfPoints)} <span class="text-xs font-normal">pts</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Section: Partnership
            if (state.activeTab === 'Partnership') {
                container.innerHTML = `
                    <div class="glass-card p-6 rounded-[2.5rem] animate-slide-up text-center">
                        <div class="w-16 h-16 bg-secondary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="${i.partnership === 'Priority' ? 'shield-check' : 'shield'}" class="text-secondary"></i>
                        </div>
                        <h3 class="font-bold text-xl">${i.partnership} Status</h3>
                        <p class="text-xs text-gray-500 mt-1 mb-6">Status kemitraan menentukan batas penarikan TF Point Anda.</p>
                        
                        <div class="bg-black/20 p-6 rounded-3xl border border-white/5">
                            <p class="text-xs text-gray-400 mb-2">Batas Redeem (${r.level})</p>
                            <p class="text-4xl font-black text-white">${r.limitPct}%</p>
                            <div class="w-full bg-white/5 h-2 rounded-full mt-4 overflow-hidden">
                                <div class="bg-secondary h-full" style="width: ${r.limitPct}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Section: Redeem
            if (state.activeTab === 'Redeem') {
                container.innerHTML = `
                    <div class="glass-card p-6 rounded-[2.5rem] animate-slide-up">
                        <h3 class="font-bold mb-6">Progress Penarikan</h3>
                        <div class="space-y-8">
                            <div>
                                <div class="flex justify-between text-xs font-bold mb-3 uppercase tracking-wider">
                                    <span class="text-gray-400">Penggunaan Limit</span>
                                    <span class="${r.progressPct >= 100 ? 'text-primary' : r.progressPct >= 80 ? 'text-warning' : 'text-secondary'}">${r.progressPct.toFixed(1)}%</span>
                                </div>
                                <div class="w-full bg-white/5 h-4 rounded-full overflow-hidden p-1 border border-white/5">
                                    <div class="h-full rounded-full transition-all duration-1000 ${r.progressPct >= 100 ? 'bg-primary' : r.progressPct >= 80 ? 'bg-warning' : 'bg-secondary'}" style="width: ${r.progressPct}%"></div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-5 bg-black/20 rounded-3xl border border-white/5">
                                    <p class="text-[9px] uppercase text-gray-400 mb-1">Maksimal Redeem</p>
                                    <p class="font-bold">${formatN(r.maxRedeemablePoints)}</p>
                                </div>
                                <div class="p-5 bg-black/20 rounded-3xl border border-white/5">
                                    <p class="text-[9px] uppercase text-gray-400 mb-1">Sudah Diambil</p>
                                    <p class="font-bold text-secondary">${formatN(i.alreadyRedeemed)}</p>
                                </div>
                            </div>

                            <div class="p-6 bg-secondary/5 border border-secondary/20 rounded-[2rem] text-center">
                                <p class="text-xs text-secondary font-bold mb-1 uppercase">Sisa Kuota Redeem</p>
                                <p class="text-3xl font-black text-white">${formatN(r.remainingRedeemable)} <span class="text-xs">pts</span></p>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Section: Simulation
            if (state.activeTab === 'Simulation') {
                container.innerHTML = `
                    <div class="glass-card p-6 rounded-[2.5rem] animate-slide-up">
                        <h3 class="font-bold mb-4">Simulasi Pendapatan</h3>
                        <p class="text-xs text-gray-500 mb-6">Bandingkan nilai cair saat ini vs potensi total setelah kenaikan status.</p>
                        
                        <div class="space-y-4">
                            <div class="p-5 bg-black/20 rounded-3xl border border-white/5 flex justify-between items-center">
                                <div>
                                    <p class="text-[10px] uppercase text-gray-500 font-bold">Cairkan Sekarang</p>
                                    <p class="text-lg font-bold text-white">${formatC(r.immediateValue)}</p>
                                </div>
                                <i data-lucide="arrow-right-circle" class="text-secondary opacity-30"></i>
                            </div>

                            <div class="p-5 bg-secondary/10 border border-secondary/20 rounded-3xl flex justify-between items-center">
                                <div>
                                    <p class="text-[10px] uppercase text-secondary font-bold">Potensi Jika Hold (100%)</p>
                                    <p class="text-lg font-bold text-white">${formatC(r.potentialValueFull)}</p>
                                </div>
                                <i data-lucide="trending-up" class="text-secondary"></i>
                            </div>

                            <div class="pt-6 border-t border-white/5">
                                <p class="text-[10px] uppercase text-gray-500 font-bold mb-1">Tertunda / Opportunity Cost</p>
                                <p class="text-2xl font-black text-warning">${formatC(r.deferredValue)}</p>
                                <p class="text-[9px] text-gray-600 mt-2 italic leading-relaxed">
                                    *Nilai di atas dihitung berdasarkan rate level ${r.level} yaitu ${formatC(r.cashRate)} per 1 TF Point.
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Section: History & Export
            if (state.activeTab === 'History') {
                container.innerHTML = `
                    <div class="glass-card p-6 rounded-[2.5rem] animate-slide-up">
                        <h3 class="font-bold mb-6">Ringkasan Riwayat</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-xs">
                                <thead class="text-gray-500 uppercase font-black border-b border-white/5">
                                    <tr>
                                        <th class="pb-4 pr-4">Periode</th>
                                        <th class="pb-4 pr-4">Medal</th>
                                        <th class="pb-4 text-right">TF Point</th>
                                    </tr>
                                </thead>
                                <tbody class="text-white">
                                    <tr class="border-b border-white/5">
                                        <td class="py-4 pr-4">${i.period}</td>
                                        <td class="py-4 pr-4">${i.medal}</td>
                                        <td class="py-4 text-right font-bold text-secondary">${formatN(r.generatedTfPoints)}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mt-8">
                            <button onclick="exportCSV()" class="p-4 bg-white/5 rounded-2xl border border-white/10 flex items-center justify-center gap-2 text-xs font-bold active:bg-white/10 transition-colors">
                                <i data-lucide="download" class="w-4 h-4"></i> CSV
                            </button>
                            <button onclick="exportPDF()" class="p-4 bg-white/5 rounded-2xl border border-white/10 flex items-center justify-center gap-2 text-xs font-bold active:bg-white/10 transition-colors">
                                <i data-lucide="file-text" class="w-4 h-4"></i> PDF
                            </button>
                        </div>
                    </div>
                `;
            }

            lucide.createIcons();
        }

        function row(label, value, target, status) {
            let colorClass = "text-gray-100";
            let icon = "";
            if (typeof status === 'object') {
                colorClass = status.pass ? "text-secondary" : "text-red-400";
                icon = status.pass ? '<i data-lucide="check" class="w-3 h-3 ml-2"></i>' : '<i data-lucide="alert-circle" class="w-3 h-3 ml-2"></i>';
            }
            return `
                <div class="flex justify-between items-center py-3 border-b border-white/5 last:border-0">
                    <span class="text-xs text-gray-500">${label}</span>
                    <div class="flex items-center">
                        <span class="font-bold ${colorClass}">${value}</span>
                        ${target !== '-' ? `<span class="text-[9px] text-gray-700 ml-2">min. ${target}</span>` : ''}
                        ${icon}
                    </div>
                </div>
            `;
        }

        /** * ==========================================
         * 3. EVENTS & HANDLERS
         * ==========================================
         */
        const modal = document.getElementById('input-modal');
        const form = document.getElementById('form-data');

        document.getElementById('btn-open-input').onclick = () => {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            lucide.createIcons();
        };

        document.getElementById('btn-close-input').onclick = () => {
            modal.classList.remove('flex');
            modal.classList.add('hidden');
        };

        form.onsubmit = (e) => {
            e.preventDefault();
            
            const data = {
                period: document.getElementById('in-period').value,
                medal: parseInt(document.getElementById('in-medal').value),
                signals: parseInt(document.getElementById('in-signals').value),
                pips: parseFloat(document.getElementById('in-pips').value),
                prevVp: parseFloat(document.getElementById('in-prev-vp').value),
                alreadyRedeemed: parseInt(document.getElementById('in-redeemed').value),
                partnership: document.getElementById('in-partnership').value
            };

            // Business Logic Validation
            state.inputs = data;
            state.results = calculateBusinessLogic(data);
            
            document.getElementById('display-period').innerText = data.period;
            
            modal.classList.add('hidden');
            renderDashboard();
        };

        // Mock Export Functions
        window.exportCSV = () => {
            if (!state.results) return;
            const rows = [
                ["Periode", "Medal", "Channel", "Valued Pips", "TF Points"],
                [state.inputs.period, state.inputs.medal, state.inputs.partnership, state.results.vp, state.results.generatedTfPoints]
            ];
            const csvContent = "data:text/csv;charset=utf-8," + rows.map(e => e.join(",")).join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `TF_Report_${state.inputs.period}.csv`);
            document.body.appendChild(link);
            link.click();
        };

        window.exportPDF = () => {
            window.print(); // Simple PDF trigger for modern browsers
        };

        // Initial Load
        renderNav();
        lucide.createIcons();

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `self.addEventListener('fetch', function(event) {});`;
                const blob = new Blob([swCode], {type: 'text/javascript'});
                const url = URL.createObjectURL(blob);
                navigator.serviceWorker.register(url).catch(() => {});
            });
        }
    </script>
</body>
</html>

